<HTML>
<HEAD>
<TITLE>Using CeGCC to compile your Windows CE application</TITLE>
</HEAD>
<BODY>
<P>
This document describes how to cross-compile Windows CE applications
using the tools provided by <A HREF="http://cegcc.berlios.de">the CeGCC project</A>.
Part of this document is dependent on the host environment,
another part is generic.
<P>
What does that sentence mean ?
The host environment is the environment in which you compile your sources
to produce an executable that can run on Windows CE.
The CeGCC project actively supports two such environments :
<UL>
<LI>a Windows environment with <A HREF="http://cygwin.com">Cygwin</A>
<LI>a Linux environment
</UL>
<P>
<H1>Getting started</H1>
<P>
In this chapter, we'll show how to compile a very simple source.
<H2>Simplistic example</H2>
<P>
You can type or copy-and-paste this source :
<P>
<PRE>
#include &lt;windows.h&gt;

int WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPWSTR lpCmdLine, int nCmdShow)
{
          MessageBoxW(0, L"HELLO!", L"H3LLO!", 0);
}
</PRE>
<P>
We've created a file named <B>dialog.c</B> that contains this code.
To compile it, run this command :
<P>
<PRE>
arm-wince-pe-gcc -o dialog.exe dialog.c
</PRE>
<P>
<H2>Commands provided</H2>
<p>
All the cross-commands have the names that are formed by using their target platform
as a prefix, and the tool name as a suffix.
For our case, the target platform is called <b>arm-wince-pe</b>
which means we're building for an <b>ARM</b> processor,
running the <b>wince</b> operating system,
and producing <b>pe</b> executable files.
An example : the C compiler is called arm-wince-pe-gcc .
<p>
<table border=1>
	<tr><td>arm-wince-pe-addr2line</td><td></td></tr>
	<tr><td>arm-wince-pe-ar</td><td>archive library management tool</td></tr>
	<tr><td>arm-wince-pe-as</td><td>the GNU assembler</td></tr>
	<tr><td>arm-wince-pe-c++filt</td><td></td></tr>
	<tr><td>arm-wince-pe-cpp</td><td>the C preprocessor</td></tr>
	<tr><td>arm-wince-pe-dlltool</td><td>a tool to create DLLs</td></tr>
	<tr><td>arm-wince-pe-gcc</td><td>the C compiler</td></tr>
	<tr><td>arm-wince-pe-gcc-4.1.0</td><td></td></tr>
	<tr><td>arm-wince-pe-gccbug</td><td></td></tr>
	<tr><td>arm-wince-pe-gcov</td><td></td></tr>
	<tr><td>arm-wince-pe-ld</td><td>the GNU linker</td></tr>
	<tr><td>arm-wince-pe-nm</td><td>the tool to inspect symbols in load modules</td></tr>
	<tr><td>arm-wince-pe-objcopy</td><td></td></tr>
	<tr><td>arm-wince-pe-objdump</td><td>a tool to print data about object files</td></tr>
	<tr><td>arm-wince-pe-ranlib</td><td>tool to add or refresh the library directory</td></tr>
	<tr><td>arm-wince-pe-readelf</td><td></td></tr>
	<tr><td>arm-wince-pe-size</td><td></td></tr>
	<tr><td>arm-wince-pe-strings</td><td></td></tr>
	<tr><td>arm-wince-pe-strip</td><td></td></tr>
	<tr><td>arm-wince-pe-windres</td><td></td></tr>
	<tr><td>cesetup</td><td></td></tr>
</table>
<H1>How to build a Makefile that works</H1>
<p>
A Makefile is a description of how to build something that depends on other sources.
We're using it for building executables from program sources, which is its most common use.
<p>
<H2>A sample Makefile</H2>
<PRE>
ARCH=		arm-wince-pe
CC=		${ARCH}-gcc ${CFLAGS}
WINDRES=	${ARCH}-windres

CFLAGS=		-g -D_WIN32_IE=0x0400

test5.exe:	test5.o test5.rsc
	${CC} -o $@ test5.o test5.rsc -lcommctrl

test5.o:	test5.c
	${CC} -c $?

test5.rsc:	test5.rc test5.h
	${WINDRES} $? $@

clean:
	-rm -f *.o *.exe *.rsc
</PRE>
<p>
To give you something to play with, all of the files for this example have been put
online :
<ul>
<li><a href="http://cegcc.berlios.de/docs/Makefile">Makefile</a>
<li><a href="http://cegcc.berlios.de/docs/test5.c">test5.c</a>
<li><a href="http://cegcc.berlios.de/docs/test5.rc">test5.rc</a>
<li><a href="http://cegcc.berlios.de/docs/test5.exe">test5.exe</a>
<li><a href="http://cegcc.berlios.de/docs/test5.h">test5.h</a>
</ul>
<p>
The executable should work on any suitable PDA.
With the menu, you should be able to create a simple line drawing and quit the application.
<h2>How does it work</h2>
<H1>CeGCC specifics</H1>
<H2>Predefined macros</H2>
<H2>Libraries</H2>
<H2>Linux specific</H2>
<H2>Cygwin specific<H2>
<H1>Recommended way to port sources</H1>
<H1>For the detail-hungry : what does it do and define</H1>
This output of a compiler run with the "-v" option shows exactly what it does, and which preprocessor symbols get defined.
<P>
<PRE>
% arm-wince-pe-gcc -g -o fibo.exe fibo.c -v
Using built-in specs.
Target: arm-wince-pe
Configured with: /home/danny/src/cegcc/svn.berlios.de/cegcc/branches/linux-build/src/gcc/configure --prefix=/usr/ppc --enable-languages=c --disable-interwork --disable-nls --enable-checking --disable-multilib --without-headers --target=arm-wince-pe i686-pc-linux-gnu
Thread model: single
gcc version 4.1.0
 /usr/ppc/libexec/gcc/arm-wince-pe/4.1.0/cc1 -quiet -v -D__CEGCC32__ -D__CEGCC__ -Dunix -D__unix__ -D__unix -idirafter /usr/ppc/lib/gcc/arm-wince-pe/4.1.0/../../../../arm-wince-pe/lib/../include/w32api -idirafter ../../include/w32api fibo.c -quiet -dumpbase fibo.c -auxbase fibo -g -version -o /home/danny/tmp/ccJiorQQ.s
ignoring nonexistent directory "/usr/ppc/lib/gcc/arm-wince-pe/4.1.0/../../../../arm-wince-pe/sys-include"
ignoring nonexistent directory "../../include/w32api"
#include "..." search starts here:
#include <...> search starts here:
 /usr/ppc/lib/gcc/arm-wince-pe/4.1.0/include
 /usr/ppc/lib/gcc/arm-wince-pe/4.1.0/../../../../arm-wince-pe/include
 /usr/ppc/lib/gcc/arm-wince-pe/4.1.0/../../../../arm-wince-pe/lib/../include/w32api
End of search list.
GNU C version 4.1.0 (arm-wince-pe)
        compiled by GNU C version 4.0.1 (4.0.1-5mdk for Mandriva Linux release 2006.0).
GGC heuristics: --param ggc-min-expand=30 --param ggc-min-heapsize=4096
Compiler executable checksum: c79cd29fe777b4560060b27dfea36e84
fibo.c:16: warning: '__stdcall__' attribute directive ignored
 /usr/ppc/lib/gcc/arm-wince-pe/4.1.0/../../../../arm-wince-pe/bin/as -mfpu=vfp -o /home/danny/tmp/ccv2vDh2.o /home/danny/tmp/ccJiorQQ.s
 /usr/ppc/libexec/gcc/arm-wince-pe/4.1.0/collect2 -Bdynamic -o fibo.exe /usr/ppc/lib/gcc/arm-wince-pe/4.1.0/../../../../arm-wince-pe/lib/crt0.o /usr/ppc/lib/gcc/arm-wince-pe/4.1.0/../../../../arm-wince-pe/lib/crtst.o -L/usr/ppc/lib/gcc/arm-wince-pe/4.1.0 -L/usr/ppc/lib/gcc/arm-wince-pe/4.1.0/../../../../arm-wince-pe/lib /home/danny/tmp/ccv2vDh2.o -lcegcc -lgcc -lcoredll -lcegcc -lgcc
% 
</PRE>
</BODY>
</HTML>
